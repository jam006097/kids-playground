{% extends 'base.html' %}
{% load static playground_tags %}

{% block title %}{{ playground.name }} 詳細{% endblock %}

{% block content %}
<div class="container my-4">
    <div class="card">
        <div class="card-header">
            <h1 class="card-title">{{ playground.name }}</h1>
        </div>
        <div class="card-body">
            <ul class="list-group list-group-flush">
                <li class="list-group-item"><strong>説明:</strong> {{ playground.description|linebreaksbr }}</li>
                <li class="list-group-item"><strong>住所:</strong> {{ playground.address }}</li>
                <li class="list-group-item"><strong>電話番号:</strong> {{ playground.phone|format_phone_number }}</li>
                <li class="list-group-item"><strong>ウェブサイト:</strong> {% if playground.website %}<a href="{{ playground.website }}" target="_blank">{{ playground.website }}</a>{% else %}なし{% endif %}</li>
                <li class="list-group-item"><strong>Google Map:</strong> {% if playground.google_map_url %}<a href="{{ playground.google_map_url }}" target="_blank">地図を見る</a>{% else %}なし{% endif %}</li>
                <li class="list-group-item"><strong>営業時間:</strong> {{ playground.formatted_opening_hours }}</li>
                <li class="list-group-item"><strong>料金:</strong> {{ playground.formatted_fee }}</li>
                <li class="list-group-item"><strong>対象年齢:</strong> {{ playground.formatted_target_age }}</li>
                <li class="list-group-item"><strong>駐車場:</strong> {{ playground.formatted_parking }}</li>
                <li class="list-group-item"><strong>雨の日の利用:</strong> {% if playground.indoor_play_area %}可能{% else %}不可{% endif %}</li>
                <li class="list-group-item"><strong>子供用トイレ:</strong> {% if playground.kids_toilet_available %}あり{% else %}なし{% endif %}</li>
                <li class="list-group-item"><strong>ベビーカー:</strong> {% if playground.stroller_accessible %}アクセス可{% else %}アクセス不可{% endif %}</li>
                <li class="list-group-item"><strong>授乳室:</strong> {% if playground.nursing_room_available %}あり{% else %}なし{% endif %}</li>
                <li class="list-group-item"><strong>おむつ交換台:</strong> {% if playground.diaper_changing_station_available %}あり{% else %}なし{% endif %}</li>
                <li class="list-group-item"><strong>昼食利用:</strong> {% if playground.lunch_allowed %}可能{% else %}不可{% endif %}</li>
            </ul>
            <a href="{% url 'myapp:index' %}" class="btn btn-secondary mt-3">一覧に戻る</a>
        </div>
    </div>

    <!-- Review Section -->
    <div class="card mt-4">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h2 class="h5 mb-0">口コミ一覧</h2>
            {% if user.is_authenticated %}
            <a href="{% url 'myapp:review_create' pk=playground.pk %}" class="btn btn-primary">
                口コミを投稿する
            </a>
            {% else %}
            <a href="{% url 'account_login' %}?next={{ request.path }}" class="btn btn-primary">ログインして口コミを投稿</a>
            {% endif %}
        </div>
        <div class="card-body">
            <ul class="list-group list-group-flush" id="review-list">
                {% for review in reviews %}
                <li class="list-group-item">
                    <strong>{{ review.user.account_name }}</strong> (評価: {{ review.rating }})<br>
                    <p class="mt-2">{{ review.content|linebreaksbr }}</p>
                    <small class="text-muted d-block text-end">投稿日: {{ review.created_at|date:"Y年m月d日 H:i" }}</small>
                </li>
                {% empty %}
                <li class="list-group-item" id="no-reviews-message">まだ口コミがありません。</li>
                {% endfor %}
            </ul>
            {% if has_more_reviews %}
            <div class="text-center mt-3">
                <a href="{% url 'myapp:view_reviews' playground.id %}" class="btn btn-outline-secondary">口コミをすべて見る</a>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Toast for notifications -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1100">
    <div id="notificationToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <strong class="me-auto">通知</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body" id="notificationToastBody">
            <!-- Message will be inserted here -->
        </div>
    </div>
</div>

{% endblock %}
